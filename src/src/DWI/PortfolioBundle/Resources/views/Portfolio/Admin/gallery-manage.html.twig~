{% extends '::base-admin.html.twig' %}

{% block title %}Manage '{{ model.gallery.title }}' Gallery{% endblock %}

{% block body %}
    <div class="canvas">
        <div class="jumbotron">
            Manage Gallery<br />
            <small>{{ model.gallery.title }}</small>
            <section class="body text-center">
                <a href="{{ url('dwi_portfolio_upload_images_form', { id: model.gallery.id }) }}" class="btn">Upload Images</a>
                {% if model.gallery.isActive %}
                    <a href="{{ url('dwi_portfolio_publish_gallery', { id: model.gallery.id }) }}" class="btn">Unpublish</a>
                {% else %}
                    <a href="{{ url('dwi_portfolio_publish_gallery', { id: model.gallery.id }) }}" class="btn">Publish</a>
                {% endif %}
                <a href="{{ url('dwi_portfolio_edit_gallery', { id: model.gallery.id }) }}" class="btn">Edit</a>
                <a href="{{ url('dwi_portfolio_remove_gallery', { id: model.gallery.id }) }}" class="btn btn-danger">Delete</a>
            </section>
        </div>
    </div>

    <div class="canvas canvas-padded slate">
        <section class="body">
            <table class="table">
                <tr>
                    <td style="width: 80%;"><div id="chart" style="background: #34495e; height: 120px; margin: 0 auto"></div></td>
                    <td class="text-center"><span><h2>{{ model.views.total }}<br /><small>Total Views</small></h2></span></td>
                </tr>
            </table>
        </section>
    </div>

    <div class="canvas canvas-padded">
        <section class="body">
            <ul class="image-list">
                {% for key, image in model.gallery.images %}
                    <li>
                        <div class="preview"><img src="{{ asset(image.webPath)|imagine_filter('gallery_thumb') }}" /></div>
                        <div>
                            {% if image.description %}
                                <span>{{ image.description }}</span><br />
                            {% else %}
                                <span>No description set.</span><br />
                            {% endif %}
                            <span class="text-muted">Last modified: {{ image.lastModified|date("F jS \\a\\t g:ia") }}.</span>

                            {% if image.id == model.gallery.coverImage.image.id %}
                                <span class="text-warning">This is the gallery cover image.</span>
                            {% endif %}
                        </div>
                        <div class="controls">
                            {% if model.gallery.images[key - 1] is defined %}
                                {% set href = url('dwi_portfolio_swap_display_order', {
                                    'id': model.gallery.id,
                                    'from': image.displayOrder,
                                    'to': model.gallery.images[key - 1].displayOrder
                                }) %}

                                <a class="btn" href="{{ href }}">&#x25B2;</a>
                            {% else %}
                                <button class="btn" disabled>&#x25B2;</button>
                            {% endif %}

                            {% if model.gallery.images[key + 1] is defined %}
                                {% set href = url('dwi_portfolio_swap_display_order', {
                                    'id': model.gallery.id,
                                    'from': image.displayOrder,
                                    'to': model.gallery.images[key + 1].displayOrder
                                }) %}

                                <a class="btn" href="{{ href }}">&#x25BC;</a>
                            {% else %}
                                <button class="btn" disabled>&#x25BC;</button>
                            {% endif %}

                            <button class="btn" data-dropdown="#dropdown-{{ key }}">Options</button>
                            <div id="dropdown-{{ key }}" class="dropdown dropdown-anchor-right dropdown-tip" style="display: none;">
                                <ul class="dropdown-menu">
                                    <li><a href="{{ url('dwi_portfolio_set_cover_gallery', {'id': model.gallery.id, 'imageId': image.id}) }}">Set Cover</a></li>
                                    <li><a href="{{ url('dwi_portfolio_remove_image', {'galleryId': model.gallery.id, 'id': image.id}) }}">Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </section>
    </div>
{% endblock %}

{% block javascript %}

    <script type="text/javascript">

        $(function () {
            $('#chart').highcharts({
                chart: {
                    type: 'area',
                    backgroundColor: '#ecf0f1'
                },
                title: {
                    text: null
                },
                subtitle: {
                    text: null
                },
                colors: [
                    '#e74c3c'
                ],
                credits: {
                    enabled: false
                },
                xAxis: {
                    type: 'datetime',
                    labels: {
                        enabled: false
                    }
                },
                yAxis: {
                    title: {
                        text: null
                    },
                    min: 0,
                    gridLineColor: '#d8dee2',
                    gridLineWidth: 2,
                    labels: {
                        enabled: false
                    }
                },
                legend: {
                    enabled: false
                },
                tooltip: {
                    formatter: function() {
                        return '<b>' + Highcharts.dateFormat('%e %b', this.x) +'</b><br />'+ this.y +' views';
                    }
                },

                series: [{
                    data: {{ model.views.chartViews|json_encode() }}
                }]
            });
        });

    </script>

{% endblock %}